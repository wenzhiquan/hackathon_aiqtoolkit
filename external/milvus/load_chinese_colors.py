#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ä¸­å›½ä¼ ç»Ÿé¢œè‰²æ•°æ®å¯¼å…¥ Milvus è„šæœ¬
å°†ä¸­å›½ä¼ ç»Ÿé¢œè‰²ä¿¡æ¯å¯¼å…¥åˆ° Milvus å‘é‡æ•°æ®åº“ä¸­
"""

import os
import sys
import json
from llama_index.core import SimpleDirectoryReader, Document
from langchain_nvidia_ai_endpoints import NVIDIAEmbeddings
from dotenv import load_dotenv
from llama_index.core import Settings
from llama_index.core import VectorStoreIndex, StorageContext
from llama_index.vector_stores.milvus import MilvusVectorStore
from llama_index.core.node_parser import TokenTextSplitter

load_dotenv()

# ä»ç¯å¢ƒå˜é‡è·å–é…ç½®
nvidia_api_key = os.getenv("NVIDIA_API_KEY")
if not nvidia_api_key:
    raise ValueError("""
    è¯·è®¾ç½® NVIDIA_API_KEY ç¯å¢ƒå˜é‡ï¼

    æ–¹æ³•1: åœ¨ external/milvus/.env æ–‡ä»¶ä¸­è®¾ç½®
    NVIDIA_API_KEY=your_api_key_here

    æ–¹æ³•2: åœ¨å‘½ä»¤è¡Œä¸­è®¾ç½®
    export NVIDIA_API_KEY=your_api_key_here

    æ–¹æ³•3: åœ¨è¿è¡Œè„šæœ¬æ—¶è®¾ç½®
    NVIDIA_API_KEY=your_api_key_here python load_chinese_colors.py
    """)

os.environ["NVIDIA_API_KEY"] = nvidia_api_key

# å…¶ä»–é…ç½®å‚æ•°
MILVUS_URI = os.getenv("MILVUS_URI", "http://127.0.0.1:19530")
COLLECTION_NAME = os.getenv("MILVUS_COLLECTION_NAME", "chinese_traditional_colors")
EMBEDDING_MODEL = os.getenv("NVIDIA_EMBEDDING_MODEL", "nvidia/nv-embedqa-e5-v5")
EMBEDDING_DIMENSION = int(os.getenv("EMBEDDING_DIMENSION", "1024"))

def load_chinese_colors_data():
    """åŠ è½½å®Œæ•´çš„ä¸­å›½ä¼ ç»Ÿé¢œè‰²æ•°æ®"""
    color_data = [
        {
            "name": "çº¢è‰²ç³»",
            "poetry": [
                {"content": "çº¢è±†ç”Ÿå—å›½ï¼Œæ˜¥æ¥å‘å‡ æ", "author": "ç‹ç»´", "title": "ç›¸æ€"},
                {"content": "åƒé‡Œèºå•¼ç»¿æ˜ çº¢ï¼Œæ°´æ‘å±±éƒ­é…’æ——é£", "author": "æœç‰§", "title": "æ±Ÿå—æ˜¥"},
                {"content": "çº¢é…¥æ‰‹ï¼Œé»„ç¸¢é…’ï¼Œæ»¡åŸæ˜¥è‰²å®«å¢™æŸ³", "author": "é™†æ¸¸", "title": "é’—å¤´å‡¤"}
            ],
            "colors": [
                {"hex": "#ffb3a7", "name": "ç²‰çº¢", "desc": "å³æµ…çº¢è‰²ã€‚åˆ«ç§°ï¼šå¦ƒè‰²ã€æ¨å¦ƒè‰²ã€æ¹˜å¦ƒè‰²ã€å¦ƒçº¢è‰²"},
                {"hex": "#ed5736", "name": "å¦ƒè‰²", "desc": "å¦ƒçº¢è‰²ã€‚å¤åŒ\"ç»¯\"ï¼Œç²‰çº¢è‰²ã€‚æ¨å¦ƒè‰²æ¹˜å¦ƒè‰²ç²‰çº¢çš†åŒä¹‰ã€‚"},
                {"hex": "#f00056", "name": "å“çº¢", "desc": "æ¯”å¤§çº¢æµ…çš„çº¢è‰²"},
                {"hex": "#f47983", "name": "æ¡ƒçº¢", "desc": "æ¡ƒèŠ±çš„é¢œè‰²ï¼Œæ¯”ç²‰çº¢ç•¥é²œæ¶¦çš„é¢œè‰²"},
                {"hex": "#db5a6b", "name": "æµ·æ£ çº¢", "desc": "æ·¡ç´«çº¢è‰²ã€è¾ƒæ¡ƒçº¢è‰²æ·±ä¸€äº›ï¼Œæ˜¯éå¸¸å¦©åªšå¨‡è‰³çš„é¢œè‰²"},
                {"hex": "#f20c00", "name": "çŸ³æ¦´çº¢", "desc": "çŸ³æ¦´èŠ±çš„é¢œè‰²ï¼Œé«˜è‰²åº¦å’Œçº¯åº¦çš„çº¢è‰²"},
                {"hex": "#c93756", "name": "æ¨±æ¡ƒè‰²", "desc": "é²œçº¢è‰²"},
                {"hex": "#f05654", "name": "é“¶çº¢", "desc": "é“¶æœ±å’Œç²‰çº¢è‰²é¢œæ–™é…æˆçš„é¢œè‰²"},
                {"hex": "#ff2121", "name": "å¤§çº¢", "desc": "æ­£çº¢è‰²ï¼Œä¸‰åŸè‰²ä¸­çš„çº¢ï¼Œä¼ ç»Ÿçš„ä¸­å›½çº¢"},
                {"hex": "#8c4356", "name": "ç»›ç´«", "desc": "ç´«ä¸­ç•¥å¸¦çº¢çš„é¢œè‰²"},
                {"hex": "#c83c23", "name": "ç»¯çº¢", "desc": "è‰³ä¸½çš„æ·±çº¢"},
                {"hex": "#9d2933", "name": "èƒ­è„‚", "desc": "å¥³å­è£…æ‰®æ—¶ç”¨çš„èƒ­è„‚çš„é¢œè‰²ï¼Œå›½ç”»æš—çº¢è‰²é¢œæ–™"},
                {"hex": "#ff4c00", "name": "æœ±çº¢", "desc": "æœ±ç ‚çš„é¢œè‰²ï¼Œæ¯”å¤§çº¢æ´»æ³¼"},
                {"hex": "#ff4e20", "name": "ä¸¹", "desc": "ä¸¹ç ‚çš„é²œè‰³çº¢è‰²"},
                {"hex": "#f35336", "name": "å½¤", "desc": "èµ¤è‰²"},
                {"hex": "#cb3a56", "name": "èŒœè‰²", "desc": "èŒœè‰æŸ“çš„è‰²å½©ï¼Œå‘ˆæ·±çº¢è‰²"},
                {"hex": "#ff2d51", "name": "ç«çº¢", "desc": "ç«ç„°çš„çº¢è‰²ï¼Œèµ¤è‰²"},
                {"hex": "#c91f37", "name": "èµ«èµ¤", "desc": "æ·±çº¢ï¼Œç«çº¢ã€‚æ³›æŒ‡èµ¤è‰²ã€ç«çº¢è‰²"},
                {"hex": "#ef7a82", "name": "å«£çº¢", "desc": "é²œè‰³çš„çº¢è‰²"},
                {"hex": "#ff0097", "name": "æ´‹çº¢", "desc": "è‰²æ©˜çº¢"},
                {"hex": "#ff3300", "name": "ç‚", "desc": "å¼•ç”³ä¸ºçº¢è‰²"},
                {"hex": "#c3272b", "name": "èµ¤", "desc": "æœ¬ä¹‰ç«çš„é¢œè‰²ï¼Œå³çº¢è‰²"},
                {"hex": "#a98175", "name": "ç»¾", "desc": "ç»›è‰²ï¼›æµ…ç»›è‰²"},
                {"hex": "#c32136", "name": "æ£çº¢", "desc": "å³æ·±çº¢"},
                {"hex": "#b36d61", "name": "æª€", "desc": "æµ…çº¢è‰²ï¼Œæµ…ç»›è‰²"},
                {"hex": "#be002f", "name": "æ®·çº¢", "desc": "å‘é»‘çš„çº¢è‰²"},
                {"hex": "#dc3023", "name": "é…¡çº¢", "desc": "åƒé¥®é…’åè„¸ä¸Šæ³›ç°çš„çº¢è‰²ï¼Œæ³›æŒ‡è„¸çº¢"},
                {"hex": "#f9906f", "name": "é…¡é¢œ", "desc": "é¥®é…’è„¸çº¢çš„æ ·å­ã€‚äº¦æ³›æŒ‡è„¸çº¢è‰²"}
            ]
        },
        {
            "name": "é»„è‰²ç³»",
            "poetry": [
                {"content": "é»„æ²³è¿œä¸Šç™½äº‘é—´ï¼Œä¸€ç‰‡å­¤åŸä¸‡ä»å±±", "author": "ç‹ä¹‹æ¶£", "title": "å‡‰å·è¯"},
                {"content": "ä¸¤ä¸ªé»„é¹‚é¸£ç¿ æŸ³ï¼Œä¸€è¡Œç™½é¹­ä¸Šé’å¤©", "author": "æœç”«", "title": "ç»å¥"}
            ],
            "colors": [
                {"hex": "#fff143", "name": "é¹…é»„", "desc": "æ·¡é»„è‰²"},
                {"hex": "#faff72", "name": "é¸­é»„", "desc": "å°é¸­æ¯›çš„é»„è‰²"},
                {"hex": "#eaff56", "name": "æ¨±è‰è‰²", "desc": "æ·¡é»„ç»¿è‰²"},
                {"hex": "#ffa400", "name": "æé»„", "desc": "æˆç†Ÿæå­çš„é»„è‰²"},
                {"hex": "#ff8c31", "name": "æçº¢", "desc": "æˆç†Ÿæå­åçº¢è‰²çš„ä¸€é¢"},
                {"hex": "#ff8936", "name": "æ©˜é»„", "desc": "æŸ‘æ©˜çš„é»„è‰²"},
                {"hex": "#ffb61e", "name": "æ©™é»„", "desc": "æ©™çš„é»„è‰²"},
                {"hex": "#ff6600", "name": "æ©˜çº¢", "desc": "æŸ‘æ©˜çš„çº¢è‰²"},
                {"hex": "#ff8c00", "name": "å§œé»„", "desc": "ä¸­è¯åã€‚åˆ«åé»„å§œã€‚ä¸ºå§œç§‘æ¤ç‰©å§œé»„çš„æ ¹èŒ"},
                {"hex": "#ffc773", "name": "ç¼ƒè‰²", "desc": "æµ…é»„è‰²"},
                {"hex": "#fa8c35", "name": "æ©™è‰²", "desc": "ç•Œäºçº¢è‰²å’Œé»„è‰²ä¹‹é—´çš„æ··åˆè‰²"},
                {"hex": "#b35c44", "name": "èŒ¶è‰²", "desc": "ä¸€ç§æ¯”æ —è‰²ç¨çº¢çš„æ£•æ©™è‰²è‡³æµ…æ£•è‰²"},
                {"hex": "#a88462", "name": "é©¼è‰²", "desc": "ä¸€ç§æ¯”å’”å½è‰²ç¨çº¢è€Œå¾®æ·¡ã€æ¯”è‚‰æ¡‚è‰²é»„è€Œç¨æ·¡å’Œæ¯”æ ¸æ¡ƒæ£•è‰²é»„è€Œæš—çš„æµ…é»„æ£•è‰²"},
                {"hex": "#c89b40", "name": "æ˜é»„", "desc": "å½¢å®¹å¤©è‰²ã€ç¯å…‰ç­‰å‘ˆå¹½æš—çš„é»„è‰²"},
                {"hex": "#60281e", "name": "æ —è‰²", "desc": "æ —å£³çš„é¢œè‰²ã€‚å³ç´«é»‘è‰²"},
                {"hex": "#b25d25", "name": "æ£•è‰²", "desc": "æ£•æ¯›çš„é¢œè‰²ï¼Œå³è¤è‰²"},
                {"hex": "#827100", "name": "æ£•ç»¿", "desc": "ç»¿ä¸­æ³›æ£•è‰²çš„ä¸€ç§é¢œè‰²"},
                {"hex": "#7c4b00", "name": "æ£•é»‘", "desc": "æ·±æ£•è‰²"},
                {"hex": "#9b4400", "name": "æ£•çº¢", "desc": "çº¢è¤è‰²"},
                {"hex": "#ae7000", "name": "æ£•é»„", "desc": "é»„è¤è‰²"},
                {"hex": "#ca6924", "name": "èµ­", "desc": "çº¢è‰²ã€èµ¤çº¢è‰²"},
                {"hex": "#9c5333", "name": "èµ­è‰²", "desc": "çº¢è¤è‰²"},
                {"hex": "#fc9d9a", "name": "ç¥ç€", "desc": "ä¸€ç§è¾ƒæ·±çš„é»„è‰²"},
                {"hex": "#6e511e", "name": "è¤è‰²", "desc": "é»„é»‘è‰²"},
                {"hex": "#c3b370", "name": "æ¯é»„", "desc": "å¹²æ¯ç„¦é»„"},
                {"hex": "#e29c45", "name": "é»„æ Œ", "desc": "ä¸€ç§è½å¶çŒæœ¨ï¼Œå¶å­ç§‹å¤©å˜æˆçº¢è‰²"},
                {"hex": "#d9b611", "name": "ç§‹è‰²", "desc": "1ã€ä¸­ç­‰çš„æˆ–æš—çš„æ£•é»„è‰² 2ã€å¤ä»¥ç§‹ä¸ºé‡‘ï¼Œå…¶è‰²ç™½ï¼Œæ•…ä»£æŒ‡ç™½è‰²"},
                {"hex": "#d2b48c", "name": "ç§‹é¦™è‰²", "desc": "æµ…æ©„æ¦„è‰² æµ…é»„è¤è‰²"}
            ]
        },
        {
            "name": "ç»¿è‰²ç³»",
            "poetry": [
                {"content": "æ˜¥é£åˆç»¿æ±Ÿå—å²¸ï¼Œæ˜æœˆä½•æ—¶ç…§æˆ‘è¿˜", "author": "ç‹å®‰çŸ³", "title": "æ³Šèˆ¹ç“œæ´²"},
                {"content": "æ—¥å‡ºæ±ŸèŠ±çº¢èƒœç«ï¼Œæ˜¥æ¥æ±Ÿæ°´ç»¿å¦‚è“", "author": "ç™½å±…æ˜“", "title": "å¿†æ±Ÿå—"}
            ],
            "colors": [
                {"hex": "#bddd22", "name": "å«©ç»¿", "desc": "åƒåˆšé•¿å‡ºçš„å«©å¶çš„æµ…ç»¿è‰²"},
                {"hex": "#c9dd22", "name": "æŸ³é»„", "desc": "åƒæŸ³æ ‘èŠ½é‚£æ ·çš„æµ…é»„è‰²"},
                {"hex": "#afdd22", "name": "æŸ³ç»¿", "desc": "æŸ³å¶çš„æµ…ç»¿è‰²"},
                {"hex": "#00e09e", "name": "ç«¹é’", "desc": "ç«¹å­çš„ç»¿è‰²"},
                {"hex": "#93de00", "name": "è‘±é»„", "desc": "é»„ç»¿è‰²ï¼Œå«©é»„è‰²"},
                {"hex": "#9ed900", "name": "è‘±ç»¿", "desc": "1ã€æµ…ç»¿åˆç•¥æ˜¾å¾®é»„çš„é¢œè‰² 2ã€è‰æœ¨é’ç¿ çš„é¢œè‰²"},
                {"hex": "#00e079", "name": "è‘±é’", "desc": "æ·¡æ·¡çš„é’ç»¿è‰²"},
                {"hex": "#44cef6", "name": "è‘±å€©", "desc": "é’ç»¿è‰²"},
                {"hex": "#00bc12", "name": "é’è‘±", "desc": "ç¿ ç»¿è‰²ï¼Œé’ç»¿è‰²"},
                {"hex": "#00bb00", "name": "æ²¹ç»¿", "desc": "å…‰æ¶¦è€Œæµ“ç»¿çš„é¢œè‰²ã€‚å¦‚æ²¹ç»¿çš„å¶å­"},
                {"hex": "#0eb83a", "name": "ç»¿æ²ˆ", "desc": "æ·±ç»¿"},
                {"hex": "#1bd1a5", "name": "ç¢§è‰²", "desc": "é’ç»¿è‰²"},
                {"hex": "#2add9c", "name": "ç¢§ç»¿", "desc": "æ¸…æ¾ˆæ˜äº®çš„ç»¿è‰²"},
                {"hex": "#48c0a3", "name": "é’ç¢§", "desc": "é²œè‰³çš„é’ç»¿è‰²"},
                {"hex": "#3de1ad", "name": "ç¿¡ç¿ è‰²", "desc": "1ã€ç¿¡ç¿ é¸Ÿç¾½æ¯›çš„é’ç»¿è‰² 2ã€ç¿¡ç¿ å®çŸ³çš„é¢œè‰²"},
                {"hex": "#00e500", "name": "è‰ç»¿", "desc": "ç»¿è€Œç•¥é»„çš„é¢œè‰²"},
                {"hex": "#00e09e", "name": "é’è‰²", "desc": "1ã€ä¸€ç±»å¸¦ç»¿çš„è“è‰²ï¼Œä¸­ç­‰æ·±æµ…ï¼Œé«˜åº¦é¥±å’Œ 2ã€æœ¬ä¹‰æ˜¯è“è‰² 3ã€æ¤ç‰©çš„ç»¿è‰² 4ã€å–»å¹´è½»çš„"},
                {"hex": "#7bcfa6", "name": "é’ç¿ ", "desc": "é²œç»¿"},
                {"hex": "#d0f0c0", "name": "é’ç™½", "desc": "ç™½è€Œå‘é’ï¼Œå°¤æŒ‡è„¸æ²¡æœ‰è¡€è‰²"},
                {"hex": "#e0eee8", "name": "é¸­åµé’", "desc": "æ·¡é’ç°è‰²ï¼Œææ·¡çš„é’ç»¿è‰²"},
                {"hex": "#424c50", "name": "èŸ¹å£³é’", "desc": "æ·±ç°ç»¿è‰²"},
                {"hex": "#2e4e7e", "name": "é¸¦é’", "desc": "é¸¦ç¾½çš„é¢œè‰²ã€‚å³é»‘è€Œå¸¦æœ‰ç´«ç»¿å…‰çš„é¢œè‰²"},
                {"hex": "#00fa54", "name": "ç»¿è‰²", "desc": "1ã€åœ¨å…‰è°±ä¸­ä»‹äºè“ä¸é»„ä¹‹é—´çš„é‚£ç§é¢œè‰² 2ã€æœ¬ä¹‰ï¼šé’ä¸­å¸¦é»„çš„é¢œè‰²"},
                {"hex": "#c3f53c", "name": "è±†ç»¿", "desc": "æµ…é»„ç»¿è‰²"},
                {"hex": "#96ce54", "name": "è±†é’", "desc": "æµ…é’ç»¿è‰²"},
                {"hex": "#1685a9", "name": "çŸ³é’", "desc": "æ·¡ç°ç»¿è‰²"},
                {"hex": "#41555d", "name": "ç‰è‰²", "desc": "ç‰çš„é¢œè‰²ï¼Œé«˜é›…çš„æ·¡ç»¿ã€æ·¡é’è‰²"},
                {"hex": "#7fecad", "name": "ç¼¥", "desc": "ç»¿è‰²è€Œå¾®ç™½"},
                {"hex": "#a4e2c6", "name": "è‰¾ç»¿", "desc": "è‰¾è‰çš„é¢œè‰²ã€‚åè‹ç™½çš„ç»¿è‰²"},
                {"hex": "#21a675", "name": "æ¾æŸç»¿", "desc": "ç»å†¬æ¾æŸå¶çš„æ·±ç»¿"},
                {"hex": "#057748", "name": "æ¾èŠ±ç»¿", "desc": "äº¦ä½œ\"æ¾èŠ±\"ã€\"æ¾ç»¿\"ã€‚åé»‘çš„æ·±ç»¿è‰²ï¼Œå¢¨ç»¿"},
                {"hex": "#bce672", "name": "æ¾èŠ±è‰²", "desc": "æ·¡é»„ç»¿è‰²ã€‚ï¼ˆæ¾æ ‘èŠ±ç²‰çš„é¢œè‰²ï¼‰æ¾èŠ±è‰²å³ç§‹é¦™è‰²"}
            ]
        },
        {
            "name": "è“è‰²ç³»",
            "poetry": [
                {"content": "è“ç”°æ—¥æš–ç‰ç”ŸçƒŸï¼Œæ­¤æƒ…å¯å¾…æˆè¿½å¿†", "author": "æå•†éš", "title": "é”¦ç‘Ÿ"},
                {"content": "ç¢§äº‘å¤©ï¼Œé»„å¶åœ°ï¼Œç§‹è‰²è¿æ³¢", "author": "èŒƒä»²æ·¹", "title": "è‹å¹•é®"}
            ],
            "colors": [
                {"hex": "#70f3ff", "name": "è“", "desc": "è“è‰²ï¼Œä¸€ç§é¢œè‰²ï¼Œå®ƒæ˜¯çº¢ç»¿è“å…‰çš„ä¸‰åŸè‰²ä¸­çš„ä¸€å…ƒï¼Œåœ¨è¿™ä¸‰ç§åŸè‰²ä¸­å®ƒçš„æ³¢é•¿æœ€çŸ­"},
                {"hex": "#177cb0", "name": "é›é’", "desc": "ä¹Ÿå«\"è“é›\"ã€‚ç”¨è“¼è“å¶æ³¡æ°´è°ƒå’Œä¸çŸ³ç°æ²‰æ·€æ‰€å¾—çš„è“è‰²æŸ“æ–™ã€‚å‘ˆæ·±è“ç»¿è‰²"},
                {"hex": "#065279", "name": "é›è“", "desc": "æ·±è“è‰²"},
                {"hex": "#3eede7", "name": "ç¢§è“", "desc": "é’è“è‰²"},
                {"hex": "#70f3ff", "name": "è”šè“", "desc": "ç±»ä¼¼æ™´æœ—å¤©ç©ºçš„é¢œè‰²çš„ä¸€ç§è“è‰²"},
                {"hex": "#4b5cc4", "name": "å®è“", "desc": "é²œè‰³æ˜äº®çš„è“è‰²"},
                {"hex": "#a1afc9", "name": "è“ç°è‰²", "desc": "ä¸€ç§è¿‘äºç°ç•¥å¸¦è“çš„æ·±ç°è‰²"},
                {"hex": "#2e4b89", "name": "è—é’", "desc": "è“è€Œè¿‘é»‘"},
                {"hex": "#3b2e7e", "name": "è—è“", "desc": "è“é‡Œç•¥é€çº¢è‰²"},
                {"hex": "#4a4266", "name": "é»›", "desc": "é’é»‘è‰²çš„é¢œæ–™ã€‚å¤ä»£å¥³å­ç”¨ä»¥ç”»çœ‰"},
                {"hex": "#426666", "name": "é»›ç»¿", "desc": "å¢¨ç»¿"},
                {"hex": "#3eede7", "name": "é»›è“", "desc": "æ·±è“è‰²"},
                {"hex": "#574266", "name": "é»›ç´«", "desc": "æ·±ç´«è‰²"},
                {"hex": "#8d4bbb", "name": "ç´«è‰²", "desc": "è“å’Œçº¢ç»„æˆçš„é¢œè‰²"},
                {"hex": "#815463", "name": "ç´«é…±", "desc": "æµ‘æµŠçš„ç´«è‰²"},
                {"hex": "#815476", "name": "é…±ç´«", "desc": "ç´«ä¸­ç•¥å¸¦çº¢çš„é¢œè‰²"},
                {"hex": "#4c221b", "name": "ç´«æª€", "desc": "æª€æœ¨çš„é¢œè‰²ï¼Œä¹Ÿç§°ä¹Œæª€è‰²ã€é»‘æª€è‰²"},
                {"hex": "#003371", "name": "ç»€é’", "desc": "çº¯æ­£çš„æ·±è“è‰²"},
                {"hex": "#003472", "name": "ç»€ç´«", "desc": "ç•¥å¸¦çº¢çš„æ·±è“è‰²"},
                {"hex": "#8d5524", "name": "ç´«æ£ ", "desc": "é»‘çº¢è‰²"},
                {"hex": "#801dae", "name": "é’è²", "desc": "åç´«çš„è“è‰²"},
                {"hex": "#4c8dae", "name": "ç¾¤é’", "desc": "æ·±è“è‰²"},
                {"hex": "#b0a4e3", "name": "é›ªé’", "desc": "æµ…è“ç´«è‰²"},
                {"hex": "#cca4e3", "name": "ä¸é¦™è‰²", "desc": "ç´«ä¸é¦™çš„é¢œè‰²ï¼Œæµ…æµ…çš„ç´«è‰²ï¼Œå¾ˆå¨‡å«©æ·¡é›…çš„è‰²å½©"},
                {"hex": "#edc9af", "name": "è—•è‰²", "desc": "æµ…ç°è€Œç•¥å¸¦çº¢çš„é¢œè‰²"},
                {"hex": "#e4c6d0", "name": "è—•è·è‰²", "desc": "æµ…ç´«è€Œç•¥å¸¦çº¢çš„é¢œè‰²"}
            ]
        },
        {
            "name": "è‹è‰²ç³»",
            "poetry": [
                {"content": "è‹è‹ç«¹æ—å¯ºï¼Œæ³æ³é’Ÿå£°æ™š", "author": "åˆ˜é•¿å¿", "title": "é€çµæ¾ˆä¸Šäºº"},
                {"content": "è‹å±±å¦‚æµ·ï¼Œæ®‹é˜³å¦‚è¡€", "author": "æ¯›æ³½ä¸œ", "title": "å¿†ç§¦å¨¥Â·å¨„å±±å…³"}
            ],
            "colors": [
                {"hex": "#75878a", "name": "è‹è‰²", "desc": "å³é’è‰²ã€‚å¤šæŒ‡é’ç»¿è‰²"},
                {"hex": "#519a73", "name": "è‹ç¿ ", "desc": "æ·±ç»¿è‰²"},
                {"hex": "#a29b7c", "name": "è‹é»„", "desc": "è‹ç™½è€Œå¸¦é»„è‰²"},
                {"hex": "#88ada6", "name": "è‹é’", "desc": "æ·±é’è‰²"},
                {"hex": "#395260", "name": "è‹é»‘", "desc": "æ·±é»‘è‰²"},
                {"hex": "#d1d9e0", "name": "è‹ç™½", "desc": "ç™½è€Œç•¥å¸¦é’è‰²ï¼›ç°ç™½"}
            ]
        },
        {
            "name": "æ°´è‰²ç³»",
            "poetry": [
                {"content": "æ°´å…‰æ½‹æ»Ÿæ™´æ–¹å¥½ï¼Œå±±è‰²ç©ºè’™é›¨äº¦å¥‡", "author": "è‹è½¼", "title": "é¥®æ¹–ä¸Šåˆæ™´åé›¨"},
                {"content": "é—®å›èƒ½æœ‰å‡ å¤šæ„ï¼Œæ°ä¼¼ä¸€æ±Ÿæ˜¥æ°´å‘ä¸œæµ", "author": "æç…œ", "title": "è™ç¾äºº"}
            ],
            "colors": [
                {"hex": "#88ada6", "name": "æ°´è‰²", "desc": "æ°´çš„é¢œè‰²"},
                {"hex": "#f3d3e7", "name": "æ°´çº¢", "desc": "æµ…æ·¡çš„çº¢è‰²"},
                {"hex": "#d4f2e7", "name": "æ°´ç»¿", "desc": "æµ…æ·¡çš„ç»¿è‰²"},
                {"hex": "#d2f0ff", "name": "æ°´è“", "desc": "æµ…è“è‰²"},
                {"hex": "#9ed1d3", "name": "æ·¡é’", "desc": "æµ…é’è‰²"},
                {"hex": "#30dff3", "name": "æ¹–è“", "desc": "æ¹–æ°´çš„è“è‰²"},
                {"hex": "#25f8cb", "name": "æ¹–ç»¿", "desc": "æ¹–æ°´çš„ç»¿è‰²"}
            ]
        },
        {
            "name": "ç°ç™½è‰²ç³»",
            "poetry": [
                {"content": "ç™½æ—¥ä¾å±±å°½ï¼Œé»„æ²³å…¥æµ·æµ", "author": "ç‹ä¹‹æ¶£", "title": "ç™»é¹³é›€æ¥¼"},
                {"content": "ç™½å¤´æ”æ›´çŸ­ï¼Œæµ‘æ¬²ä¸èƒœç°ª", "author": "æœç”«", "title": "æ˜¥æœ›"}
            ],
            "colors": [
                {"hex": "#ffffff", "name": "ç²¾ç™½", "desc": "çº¯ç™½è‰²"},
                {"hex": "#fffbf0", "name": "è±¡ç‰™ç™½", "desc": "ä¹³ç™½è‰²"},
                {"hex": "#f0fcff", "name": "é›ªç™½", "desc": "å¦‚é›ªèŠ±èˆ¬çš„ç™½è‰²"},
                {"hex": "#d6ecf0", "name": "æœˆç™½", "desc": "æ·¡è“è‰²"},
                {"hex": "#e0f0e9", "name": "ç¼Ÿ", "desc": "ç™½è‰²"},
                {"hex": "#f0f0f4", "name": "ç´ ", "desc": "ç™½è‰²ï¼Œæ— è‰²"},
                {"hex": "#f3f9f1", "name": "è¼ç™½", "desc": "å¦‚è¼ä¹‹ç™½è‰²"},
                {"hex": "#e9f1f6", "name": "éœœè‰²", "desc": "å¦‚éœœçš„ç™½è‰²"},
                {"hex": "#fcefe8", "name": "èŠ±ç™½", "desc": "ç™½è‰²å’Œåˆ«çš„é¢œè‰²ç›¸é—´"},
                {"hex": "#fdf6e3", "name": "é±¼è‚šç™½", "desc": "ä¼¼é±¼è…¹éƒ¨çš„é¢œè‰²ï¼Œå¤šæŒ‡é»æ˜æ—¶ä¸œæ–¹çš„é¢œè‰²"},
                {"hex": "#fcfff4", "name": "è¹ç™½", "desc": "æ™¶è¹æ´ç™½"},
                {"hex": "#808080", "name": "ç°è‰²", "desc": "é»‘è‰²å’Œç™½è‰²æ··åˆæˆçš„ä¸€ç§é¢œè‰²"},
                {"hex": "#eedeb0", "name": "ç‰™è‰²", "desc": "è±¡ç‰™çš„é¢œè‰²ï¼Œå¾®å¸¦é»„è‰²çš„ç™½"},
                {"hex": "#f0f0f0", "name": "é“…ç™½", "desc": "ç™½è€Œç•¥å¸¦è“çš„é¢œè‰²"}
            ]
        },
        {
            "name": "é»‘è‰²ç³»",
            "poetry": [
                {"content": "é»‘äº‘å‹åŸåŸæ¬²æ‘§ï¼Œç”²å…‰å‘æ—¥é‡‘é³å¼€", "author": "æè´º", "title": "é›é—¨å¤ªå®ˆè¡Œ"},
                {"content": "å¢¨æ¢…èŠ±å¼€ä¸äº‰æ˜¥ï¼Œåªç•™æ¸…æ°”æ»¡ä¹¾å¤", "author": "ç‹å†•", "title": "å¢¨æ¢…"}
            ],
            "colors": [
                {"hex": "#622a1d", "name": "ç„è‰²", "desc": "èµ¤é»‘è‰²ï¼Œé»‘ä¸­å¸¦çº¢"},
                {"hex": "#3d3b4f", "name": "ç„é’", "desc": "æ·±é»‘è‰²"},
                {"hex": "#392f41", "name": "ä¹Œè‰²", "desc": "æš—è€Œå‘ˆé»‘çš„é¢œè‰²"},
                {"hex": "#392f41", "name": "ä¹Œé»‘", "desc": "æ·±é»‘è‰²"},
                {"hex": "#161823", "name": "æ¼†é»‘", "desc": "éå¸¸é»‘çš„"},
                {"hex": "#50616d", "name": "å¢¨è‰²", "desc": "å³é»‘è‰²"},
                {"hex": "#758a99", "name": "å¢¨ç°", "desc": "å³é»‘ç°"},
                {"hex": "#000000", "name": "é»‘è‰²", "desc": "äº®åº¦æœ€ä½çš„éå½©è‰²çš„æˆ–æ¶ˆè‰²å·®çš„ç‰©ä½“çš„é¢œè‰²"},
                {"hex": "#493131", "name": "ç¼è‰²", "desc": "å¸›é»‘è‰²"},
                {"hex": "#312520", "name": "ç…¤é»‘", "desc": "ç…¤çš„é¢œè‰²ï¼Œæ·±é»‘è‰²"},
                {"hex": "#5d513c", "name": "é»§", "desc": "é»‘ä¸­å¸¦é»„çš„é¢œè‰²"},
                {"hex": "#75664d", "name": "é»", "desc": "é»‘è‰²"},
                {"hex": "#665757", "name": "é»", "desc": "é’é»‘è‰²"},
                {"hex": "#41555d", "name": "é»é»‘", "desc": "é¢œè‰²æ·±é»‘"},
                {"hex": "#41555d", "name": "é»¯", "desc": "æ·±é»‘è‰²ï¼›é˜´æš—çš„æ ·å­"}
            ]
        },
        {
            "name": "é‡‘é“¶è‰²ç³»",
            "poetry": [
                {"content": "é‡‘é£ç‰éœ²ä¸€ç›¸é€¢ï¼Œä¾¿èƒœå´äººé—´æ— æ•°", "author": "ç§¦è§‚", "title": "é¹Šæ¡¥ä»™"},
                {"content": "é“¶çƒ›ç§‹å…‰å†·ç”»å±ï¼Œè½»ç½—å°æ‰‡æ‰‘æµè¤", "author": "æœç‰§", "title": "ç§‹å¤•"}
            ],
            "colors": [
                {"hex": "#f2be45", "name": "èµ¤é‡‘", "desc": "è¶³é‡‘çš„é¢œè‰²"},
                {"hex": "#eacd76", "name": "é‡‘è‰²", "desc": "ä¸€ç§å¹³å‡ä¸ºæ·±é»„çš„é¢œè‰²"},
                {"hex": "#e9e7ef", "name": "é“¶ç™½", "desc": "å¸¦é“¶å…‰çš„ç™½è‰²"},
                {"hex": "#b5b5bd", "name": "è€é“¶", "desc": "é‡‘å±é“¶çš„é¢œè‰²"},
                {"hex": "#392f41", "name": "ä¹Œé‡‘", "desc": "é»‘è€Œå‘äº®çš„é¢œè‰²"},
                {"hex": "#549688", "name": "é“œç»¿", "desc": "é“œç»¿çš„é¢œè‰²"}
            ]
        }
    ]
    return color_data

def hex_to_rgb(hex_color):
    """å°†HEXé¢œè‰²å€¼è½¬æ¢ä¸ºRGB"""
    hex_color = hex_color.lstrip('#')
    return tuple(int(hex_color[i:i+2], 16) for i in (0, 2, 4))

def create_color_documents(color_data):
    """å°†é¢œè‰²æ•°æ®è½¬æ¢ä¸º Document å¯¹è±¡"""
    documents = []
    
    for category in color_data:
        category_name = category["name"]
        
        # ä¸ºæ¯ä¸ªé¢œè‰²åˆ›å»ºä¸€ä¸ªæ–‡æ¡£
        for color in category["colors"]:
            # è®¡ç®—RGBå€¼
            rgb = hex_to_rgb(color['hex'])
            
            # åˆ›å»ºä¸°å¯Œçš„æ–‡æ¡£å†…å®¹
            content = f"""é¢œè‰²åç§°: {color['name']}
è‰²ç³»åˆ†ç±»: {category_name}
HEXè‰²å€¼: {color['hex']}
RGBè‰²å€¼: R{rgb[0]} G{rgb[1]} B{rgb[2]}
é¢œè‰²æè¿°: {color['desc']}

æ–‡åŒ–å†…æ¶µä¸ç›¸å…³è¯—è¯:
"""
            # æ·»åŠ ç›¸å…³è¯—è¯
            for poem in category.get("poetry", []):
                content += f'"{poem["content"]}" â€”â€” {poem["author"]}ã€Š{poem["title"]}ã€‹\n'
            
            content += f"\nè¿™æ˜¯ä¸­å›½ä¼ ç»Ÿé¢œè‰²ä¸­{category_name}çš„ä»£è¡¨è‰²å½©ä¹‹ä¸€ï¼Œä½“ç°äº†ä¸­åæ–‡åŒ–å¯¹è‰²å½©çš„ç‹¬ç‰¹ç†è§£å’Œå®¡ç¾è¿½æ±‚ã€‚"
            
            # åˆ›å»ºæ–‡æ¡£å¯¹è±¡ï¼ŒåŒ…å«ä¸°å¯Œçš„å…ƒæ•°æ®
            doc = Document(
                text=content,
                metadata={
                    "color_name": color['name'],
                    "category": category_name,
                    "hex_value": color['hex'],
                    "rgb_r": rgb[0],
                    "rgb_g": rgb[1],
                    "rgb_b": rgb[2],
                    "description": color['desc'],
                    "source": "ä¸­å›½ä¼ ç»Ÿé¢œè‰²æ‰‹å†Œ",
                    "type": "traditional_chinese_color",
                    "cultural_significance": "ä¸­åä¼ ç»Ÿæ–‡åŒ–è‰²å½©"
                }
            )
            documents.append(doc)
    
    return documents

def main():
    print("ğŸ¨ å¼€å§‹åŠ è½½ä¸­å›½ä¼ ç»Ÿé¢œè‰²æ•°æ®åˆ° Milvus...")
    
    # 1. åŠ è½½é¢œè‰²æ•°æ®
    color_data = load_chinese_colors_data()
    print(f"ğŸ“š åŠ è½½äº† {len(color_data)} ä¸ªè‰²ç³»çš„æ•°æ®")
    
    # ç»Ÿè®¡æ€»é¢œè‰²æ•°é‡
    total_colors = sum(len(category["colors"]) for category in color_data)
    print(f"ğŸŒˆ æ€»å…±åŒ…å« {total_colors} ç§ä¼ ç»Ÿé¢œè‰²")
    
    # 2. è½¬æ¢ä¸ºæ–‡æ¡£å¯¹è±¡
    documents = create_color_documents(color_data)
    print(f"ğŸ“„ åˆ›å»ºäº† {len(documents)} ä¸ªé¢œè‰²æ–‡æ¡£")
    
    # 3. é…ç½®æ–‡æœ¬åˆ†å‰²å™¨
    splitter = TokenTextSplitter(
        chunk_size=512,  # æ¯ä¸ªå—çš„ç›®æ ‡tokenæ•°
        chunk_overlap=50,   # ç›¸é‚»å—ä¹‹é—´çš„é‡å tokenæ•°
        backup_separators=["ã€‚", "ï¼", "ï¼Ÿ", "\n", "â€”â€”"]  # ä¸­æ–‡æ–‡æ¡£åˆ†éš”ç¬¦
    )
    
    # 4. é…ç½®åµŒå…¥æ¨¡å‹
    print(f"ğŸ”§ é…ç½® NVIDIA åµŒå…¥æ¨¡å‹: {EMBEDDING_MODEL}")
    embedder = NVIDIAEmbeddings(model=EMBEDDING_MODEL, truncate="END")
    Settings.embed_model = embedder
    
    # 5. é…ç½® Milvus å‘é‡å­˜å‚¨
    print(f"ğŸ—„ï¸  é…ç½® Milvus å‘é‡å­˜å‚¨: {MILVUS_URI}")
    vector_store = MilvusVectorStore(
        uri=MILVUS_URI,
        dim=EMBEDDING_DIMENSION,  # åµŒå…¥æ¨¡å‹çš„ç»´åº¦
        collection_name=COLLECTION_NAME,
        embedding_field="vector",
        overwrite=True  # è¦†ç›–å·²å­˜åœ¨çš„é›†åˆ
    )
    storage_context = StorageContext.from_defaults(vector_store=vector_store)
    
    # 6. åˆ›å»ºç´¢å¼•å¹¶å¯¼å…¥æ•°æ®
    print("âš¡ æ­£åœ¨åˆ›å»ºå‘é‡ç´¢å¼•å¹¶å¯¼å…¥æ•°æ®...")
    index = VectorStoreIndex.from_documents(
        documents,
        storage_context=storage_context,
        transformations=[splitter]
    )
    
    print("\nâœ… ä¸­å›½ä¼ ç»Ÿé¢œè‰²æ•°æ®å·²æˆåŠŸå¯¼å…¥ Milvus!")
    print(f"ğŸ“Š é›†åˆåç§°: chinese_traditional_colors")
    print(f"ğŸ“ˆ æ–‡æ¡£æ•°é‡: {len(documents)}")
    print(f"ğŸ¯ å‘é‡ç»´åº¦: 1024")
    print(f"ğŸŒˆ è‰²ç³»æ•°é‡: {len(color_data)}")
    print(f"ğŸ¨ é¢œè‰²æ€»æ•°: {total_colors}")
    
    # æ˜¾ç¤ºå„è‰²ç³»çš„é¢œè‰²æ•°é‡
    print("\nğŸ“‹ å„è‰²ç³»è¯¦æƒ…:")
    for category in color_data:
        print(f"  â€¢ {category['name']}: {len(category['colors'])} ç§é¢œè‰²")
    
    return index

if __name__ == "__main__":
    index = main()
